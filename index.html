<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spin the Wheel ðŸŽ¡</title>
<style>
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        text-align: center;
        background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
        margin: 0;
        padding: 20px;
    }
    h1 {
        margin: 10px 0;
    }
    #lang-switch {
        position: absolute;
        top: 15px;
        right: 15px;
        background: white;
        border: 1px solid #ccc;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }
    #input-area {
        max-width: 500px;
        margin: auto;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    textarea {
        width: 100%;
        height: 80px;
        font-size: 16px;
        padding: 10px;
        border-radius: 5px;
        resize: none;
        border: 1px solid #ccc;
    }
    button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background-color: #1976d2;
        color: white;
        transition: background 0.2s;
    }
    button:hover {
        background-color: #1565c0;
    }
    canvas {
        margin-top: 20px;
        max-width: 100%;
        height: auto;
    }
    #result {
        font-size: 1.4rem;
        font-weight: bold;
        margin-top: 15px;
    }
</style>
</head>
<body>

<button id="lang-switch">EN</button>
<h1 id="title">ðŸŽ¯ Spin the Wheel</h1>

<div id="input-area">
    <label id="label">Entrez vos options (sÃ©parÃ©es par des virgules) :</label>
    <textarea id="entries" placeholder="Ex : Pizza, Burger, Sushi"></textarea>
    <br>
    <button id="generate-wheel">GÃ©nÃ©rer la roue</button>
</div>

<canvas id="wheel" width="500" height="500"></canvas>
<button id="spin">Tourner ðŸŽ¡</button>

<h2 id="result"></h2>

<audio id="spin-sound" src="https://www.soundjay.com/buttons/button-16.mp3" preload="auto"></audio>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const generateBtn = document.getElementById("generate-wheel");
const spinBtn = document.getElementById("spin");
const result = document.getElementById("result");
const spinSound = document.getElementById("spin-sound");
const langSwitch = document.getElementById("lang-switch");
const label = document.getElementById("label");
const title = document.getElementById("title");

let entries = JSON.parse(localStorage.getItem("wheelEntries")) || [];
let startAngle = 0;
let arc;
let spinTimeout = null;
let spinAngleStart;
let spinTime = 0;
let spinTimeTotal = 0;

const translations = {
    fr: {
        title: "ðŸŽ¯ Spin the Wheel",
        label: "Entrez vos options (sÃ©parÃ©es par des virgules) :",
        placeholder: "Ex : Pizza, Burger, Sushi",
        generate: "GÃ©nÃ©rer la roue",
        spin: "Tourner ðŸŽ¡",
        result: "ðŸŽ‰ RÃ©sultat : ",
        langBtn: "EN"
    },
    en: {
        title: "ðŸŽ¯ Spin the Wheel",
        label: "Enter your options (separated by commas):",
        placeholder: "E.g.: Pizza, Burger, Sushi",
        generate: "Generate Wheel",
        spin: "Spin ðŸŽ¡",
        result: "ðŸŽ‰ Result: ",
        langBtn: "FR"
    }
};

let currentLang = navigator.language.startsWith("fr") ? "fr" : "en";

function applyTranslations() {
    const t = translations[currentLang];
    title.textContent = t.title;
    label.textContent = t.label;
    document.getElementById("entries").placeholder = t.placeholder;
    generateBtn.textContent = t.generate;
    spinBtn.textContent = t.spin;
    langSwitch.textContent = t.langBtn;
}

langSwitch.addEventListener("click", () => {
    currentLang = currentLang === "fr" ? "en" : "fr";
    applyTranslations();
});

function drawWheel() {
    const outsideRadius = 200;
    const textRadius = 160;
    const insideRadius = 50;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    arc = Math.PI / (entries.length / 2);
    for (let i = 0; i < entries.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = `hsl(${i * 360 / entries.length}, 70%, 50%)`;
        ctx.beginPath();
        ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
        ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
        ctx.fill();
        ctx.save();
        ctx.fillStyle = "white";
        ctx.translate(250 + Math.cos(angle + arc / 2) * textRadius,
                      250 + Math.sin(angle + arc / 2) * textRadius);
        ctx.rotate(angle + arc / 2);
        ctx.font = "bold 16px Arial";
        ctx.fillText(entries[i], -ctx.measureText(entries[i]).width / 2, 0);
        ctx.restore();
    }
    // FlÃ¨che
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.moveTo(250 - 10, 250 - (outsideRadius + 20));
    ctx.lineTo(250 + 10, 250 - (outsideRadius + 20));
    ctx.lineTo(250, 250 - (outsideRadius - 5));
    ctx.fill();
}

function rotateWheel() {
    spinTime += 30;
    if (spinTime >= spinTimeTotal) {
        stopRotateWheel();
        return;
    }
    const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
    startAngle += (spinAngle * Math.PI / 180);
    drawWheel();
    spinSound.play();
    spinTimeout = requestAnimationFrame(rotateWheel);
}

function stopRotateWheel() {
    cancelAnimationFrame(spinTimeout);
    const degrees = startAngle * 180 / Math.PI + 90;
    const arcd = arc * 180 / Math.PI;
    const index = Math.floor((360 - (degrees % 360)) / arcd);
    result.textContent = translations[currentLang].result + entries[index];
}

function easeOut(t, b, c, d) {
    const ts = (t /= d) * t;
    const tc = ts * t;
    return b + c * (tc + -3 * ts + 3 * t);
}

generateBtn.addEventListener("click", () => {
    const raw = document.getElementById("entries").value;
    entries = raw.split(",").map(e => e.trim()).filter(e => e);
    if (entries.length < 2) {
        alert(currentLang === "fr" ? "Entrez au moins deux options !" : "Enter at least two options!");
        return;
    }
    localStorage.setItem("wheelEntries", JSON.stringify(entries));
    drawWheel();
});

spinBtn.addEventListener("click", () => {
    if (entries.length < 2) {
        alert(currentLang === "fr" ? "GÃ©nÃ©rez la roue avant de tourner !" : "Generate the wheel before spinning!");
        return;
    }
    spinAngleStart = Math.random() * 10 + 10;
    spinTime = 0;
    spinTimeTotal = Math.random() * 3000 + 4000;
    rotateWheel();
});

if (entries.length > 0) {
    document.getElementById("entries").value = entries.join(", ");
    drawWheel();
}

applyTranslations();
</script>
</body>
</html>
